<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Insider Activity - Daily Dividend</title>
  <meta name="description" content="Track insider trading activity from FAANG companies. Monitor buy and sell transactions by executives and directors.">
  
  <!-- Access Control -->
  <script type="module">
    import { isRemembered } from '../auth.js';
    if (!isRemembered()) {
      window.location.href = '/login.html';
    } else {
      const showLogout = () => {
        const btn = document.getElementById('logoutBtn');
        if (btn) btn.style.display = 'inline-block';
      };
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', showLogout);
      } else {
        showLogout();
      }
    }
  </script>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Montserrat:wght@500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" media="print" onload="this.media='all'">
  <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"></noscript>
  <link rel="stylesheet" href="../styles.css?v=17">
  
  <style>
    :root {
      --im-bg-body: #f3f4f6;
      --im-surface: #ffffff;
      --im-surface-soft: #f9fafb;
      --im-text-primary: #111827;
      --im-text-secondary: #4b5563;
      --im-accent: #2563eb;
      --im-accent-soft: #eff6ff;
      --im-success: #16a34a;
      --im-danger: #dc2626;
    }
    
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      line-height: 1.5;
      background: var(--im-bg-body);
      color: var(--im-text-primary);
      padding-top: 70px;
    }
    
    h1, h2, h3, h4, h5, h6 {
      font-family: 'Montserrat', sans-serif;
      font-weight: 600;
      letter-spacing: -0.02em;
    }
    
    body * {
      font-family: inherit;
    }
    
    a { color: inherit; text-decoration: none; }
    
    .navbar {
      position: fixed;
      inset: 0 0 auto 0;
      background: #ffffff;
      border-bottom: 1px solid rgba(229, 231, 235, 0.7);
      backdrop-filter: blur(16px);
      z-index: 1000;
    }
    
    .nav-container {
      max-width: 1200px;
      margin: 0 auto;
      height: 70px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 28px;
    }
    
    .nav-logo img {
      width: 120px !important;
      height: 40px !important;
      border-radius: 12px;
      object-fit: contain;
    }
    
    .nav-links {
      display: flex;
      align-items: center;
      gap: 26px;
    }
    
    .nav-links > a {
      font-weight: 500;
      font-size: 0.95rem;
      padding: 8px 12px;
      border-radius: 12px;
      color: #4b5563;
      transition: all 0.2s ease;
    }
    
    .nav-links > a:hover,
    .nav-links > a:focus {
      background: rgba(229, 231, 235, 0.7);
      color: var(--im-text-primary);
      outline: none;
    }
    
    .mobile-menu-btn { display: none; }
    .mobile-menu { display: none; }
    
    .im-hero {
      background: linear-gradient(135deg, #111827 0%, #1f2937 50%, #0f172a 100%);
      padding: 60px 20px 40px;
      text-align: center;
      color: #f9fafb;
    }
    
    .im-hero h1 {
      margin: 0 0 12px;
      font-size: clamp(2rem, 5vw, 3rem);
      letter-spacing: -0.02em;
    }
    
    .im-hero p {
      margin: 0 auto;
      max-width: 620px;
      color: rgba(249, 250, 251, 0.7);
      font-size: 1.05rem;
      line-height: 1.6;
    }
    
    .im-wrapper {
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    /* Company Grid */
    .company-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }

    .company-panel {
      background: var(--im-surface);
      border-radius: 16px;
      padding: 24px 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 1px solid rgba(229, 231, 235, 0.8);
      position: relative;
      overflow: hidden;
    }

    .company-panel:hover {
      transform: translateY(-4px);
      border-color: var(--im-accent);
      box-shadow: 0 12px 24px rgba(37, 99, 235, 0.08);
    }

    .company-logo-box {
      width: 48px;
      height: 48px;
      background: var(--im-accent-soft);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 16px;
      font-size: 1.25rem;
      color: var(--im-accent);
    }

    .company-panel h2 {
      margin: 0 0 6px;
      font-size: 1.1rem;
      color: var(--im-text-primary);
    }

    .company-panel .trade-count {
      font-size: 0.9rem;
      color: var(--im-text-secondary);
    }

    /* Detail Section */
    #detailSection {
      display: none;
      animation: fadeIn 0.4s ease-out;
    }

    .detail-header {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: center;
      margin-bottom: 24px;
      padding: 0 10px;
    }

    #selectedCompanyName {
      grid-column: 2;
      margin: 0;
      font-size: 1.5rem;
      font-weight: 900;
      color: var(--im-text-primary);
      text-align: center;
      letter-spacing: -0.04em;
      text-transform: uppercase;
      background: linear-gradient(135deg, #111827 0%, #374151 100%);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      display: inline-block;
    }

    .back-btn {
      grid-column: 1;
      justify-self: start;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      background: var(--im-surface);
      border: 1px solid rgba(229, 231, 235, 0.8);
      border-radius: 10px;
      font-weight: 600;
      font-size: 0.85rem;
      color: var(--im-text-secondary);
      cursor: pointer;
      transition: all 0.2s;
    }

    .back-btn:hover {
      background: #f9fafb;
      color: var(--im-text-primary);
      border-color: var(--im-accent);
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .im-filters {
      background: var(--im-surface);
      border-radius: 18px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      align-items: center;
    }
    
    .im-filter-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
      flex: 1;
      min-width: 200px;
    }
    
    .im-filter-group label {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--im-text-secondary);
    }
    
    .im-filter-group select,
    .im-filter-group input {
      padding: 10px 14px;
      border: 1px solid rgba(229, 231, 235, 0.8);
      border-radius: 10px;
      font-size: 0.95rem;
      background: var(--im-surface);
      color: var(--im-text-primary);
      transition: all 0.2s ease;
    }
    
    .im-filter-group select:focus,
    .im-filter-group input:focus {
      outline: none;
      border-color: var(--im-accent);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }
    
    .im-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-bottom: 24px;
    }

    .im-stat-card {
      background: var(--im-surface);
      border-radius: 12px;
      padding: 12px 10px;
      text-align: center;
      box-shadow: 
        0 1px 2px rgba(0,0,0,0.02);
      border: 1px solid rgba(229, 231, 235, 0.5);
      transition: all 0.2s ease;
      display: flex;
      flex-direction: column;
      justify-content: center;
      min-height: 80px;
    }

    .im-stat-card:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.04);
      border-color: rgba(37, 99, 235, 0.2);
    }

    .im-stat-card h3 {
      margin: 0 0 4px;
      font-size: 0.6rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--im-text-secondary);
      opacity: 0.7;
    }

    .im-stat-card .stat-value {
      font-size: 1.25rem;
      font-weight: 800;
      color: var(--im-text-primary);
      line-height: 1.1;
    }

    .im-stat-card .stat-percent {
      font-size: 0.65rem;
      font-weight: 700;
      margin-top: 6px;
      padding-top: 6px;
      border-top: 1px solid rgba(229, 231, 235, 0.3);
    }

    /* Accent borders for key metrics */
    .im-stat-card.buy-card { border-left: 3px solid var(--im-success); }
    .im-stat-card.sell-card { border-left: 3px solid var(--im-danger); }

    @media (max-width: 1024px) {
      .im-stats { grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 640px) {
      .im-stats { grid-template-columns: 1fr; }
    }
    
    .im-table-container {
      background: var(--im-surface);
      border-radius: 18px;
      overflow: hidden;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    .im-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .im-table thead {
      background: var(--im-surface-soft);
    }
    
    .im-table th {
      padding: 16px;
      text-align: left;
      font-weight: 600;
      font-size: 0.875rem;
      color: var(--im-text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      border-bottom: 2px solid rgba(229, 231, 235, 0.8);
    }
    
    .im-table td {
      padding: 16px;
      border-bottom: 1px solid rgba(229, 231, 235, 0.5);
      font-size: 0.95rem;
    }
    
    .im-table tbody tr:hover {
      background: var(--im-surface-soft);
    }
    
    .im-table tbody tr:last-child td {
      border-bottom: none;
    }
    
    .transaction-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 6px;
      font-size: 0.875rem;
      font-weight: 600;
    }
    
    .transaction-badge.buy {
      background: rgba(22, 163, 74, 0.1);
      color: var(--im-success);
    }
    
    .transaction-badge.sell {
      background: rgba(220, 38, 38, 0.1);
      color: var(--im-danger);
    }
    
    .quantity {
      font-weight: 600;
      color: var(--im-text-primary);
    }
    
    .company-name {
      font-weight: 600;
      color: var(--im-text-primary);
    }
    
    .insider-name {
      color: var(--im-text-primary);
    }
    
    .insider-position {
      font-size: 0.875rem;
      color: var(--im-text-secondary);
      margin-top: 4px;
    }
    
    .no-results {
      text-align: center;
      padding: 60px 20px;
      color: var(--im-text-secondary);
    }
    
    .no-results i {
      font-size: 3rem;
      margin-bottom: 16px;
      opacity: 0.3;
    }

    .im-disclaimer {
      margin-top: 40px;
      padding: 20px;
      text-align: center;
      font-size: 0.85rem;
      color: var(--im-text-secondary);
      border-top: 1px solid rgba(229, 231, 235, 0.5);
      line-height: 1.5;
    }

    @media (max-width: 768px) {
      .nav-links { display: none; }
      .mobile-menu-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 42px;
        height: 42px;
        border-radius: 12px;
        border: 1px solid rgba(148, 163, 184, 0.35);
        background: #ffffff;
        color: var(--im-text-primary);
        font-size: 1.2rem;
        cursor: pointer;
      }
      .mobile-menu {
        position: absolute;
        top: 70px;
        left: 0;
        right: 0;
        background: #ffffff;
        display: none;
        flex-direction: column;
        gap: 12px;
        padding: 18px 24px;
        border-bottom: 1px solid rgba(229, 231, 235, 0.7);
      }
      .mobile-menu.active { display: flex; }
      .mobile-menu a {
        color: #1f2937;
        font-weight: 600;
        padding: 10px 0;
      }

      /* Page spacing */
      .im-wrapper { padding: 24px 14px; }
      .im-hero { padding: 44px 16px 28px; }
      .im-hero p { font-size: 0.92rem; }

      /* Company list */
      .company-grid {
        grid-template-columns: 1fr;
        gap: 14px;
        margin-bottom: 24px;
      }
      .company-panel { padding: 18px 16px; }
      .company-panel h2 { font-size: 1.05rem; }

      /* Detail header */
      .detail-header {
        grid-template-columns: 1fr;
        gap: 10px;
        padding: 0;
        margin-bottom: 16px;
      }
      .back-btn {
        grid-column: auto;
        justify-self: stretch;
        justify-content: center;
      }
      #selectedCompanyName {
        grid-column: auto;
        font-size: 1.15rem;
        line-height: 1.15;
        word-break: break-word;
      }
      
      .im-filters {
        flex-direction: column;
        padding: 16px;
        gap: 12px;
      }
      
      .im-filter-group {
        width: 100%;
        min-width: 0;
      }
      
      .im-table-container {
        overflow-x: auto;
      }
      
      .im-table {
        min-width: 560px;
      }

      .im-table th,
      .im-table td {
        padding: 12px;
      }
      .im-table th { font-size: 0.8rem; }
      .im-table td { font-size: 0.9rem; }
      
      .im-stats {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        margin-bottom: 16px;
      }

      .im-stat-card {
        min-height: 72px;
        padding: 10px 8px;
      }
      .im-stat-card h3 { font-size: 0.55rem; }
      .im-stat-card .stat-value { font-size: 1.05rem; }
      .im-stat-card .stat-percent { font-size: 0.62rem; }

      .im-disclaimer {
        margin-top: 28px;
        padding: 16px 10px;
        font-size: 0.8rem;
      }
    }

    @media (max-width: 420px) {
      .im-stats { grid-template-columns: 1fr; }
      .im-table { min-width: 520px; }
    }
  </style>
</head>
<body>
  <nav class="navbar" role="navigation" aria-label="Main navigation">
    <div class="nav-container">
      <div class="nav-logo">
        <a href="../index.html"><img src="../DDlogo.png?v=2" alt="Daily Dividend Logo - Markets within minutes" class="logo-dd-image" width="120" height="40" style="border-radius:12px;"></a>
      </div>
      <div class="nav-links" role="menubar">
        <a href="../index.html#features">About Us</a>
        <a href="../index.html#how-it-works">What We Offer</a>
        <a href="../index.html#pricing">Pricing</a>
        <a href="../index.html#test">Test</a>
        <a href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</a>
        <a href="index.html">Tools</a>
      </div>
      <button class="mobile-menu-btn" type="button" aria-label="Toggle navigation menu" onclick="toggleMobileMenu()">
        <i class="fas fa-bars"></i>
      </button>
      <div class="mobile-menu" id="mobileMenu">
        <a href="../index.html#features" onclick="closeMobileMenu()">About Us</a>
        <a href="../index.html#how-it-works" onclick="closeMobileMenu()">What We Offer</a>
        <a href="../index.html#pricing" onclick="closeMobileMenu()">Pricing</a>
        <a href="../index.html#test" onclick="closeMobileMenu()">Test</a>
        <a href="index.html" onclick="closeMobileMenu()">Tools</a>
      </div>
    </div>
  </nav>

  <main>
    <section class="im-hero" id="imHero" aria-labelledby="im-hero-heading">
      <h1 id="im-hero-heading">Insider Activity</h1>
      <p style="font-size: 0.95rem;">Analytical snapshot of insider trading activity as of Q3. Outright equities flow only.</p>
    </section>

    <div class="im-wrapper">
      <!-- Landing View: Company Panels -->
      <div id="landingView">
        <div class="company-grid" id="companyGrid">
          <div class="no-results">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Loading companies...</p>
          </div>
        </div>
      </div>

      <!-- Detail View: Transactions -->
      <div id="detailSection">
        <div class="detail-header">
          <div class="back-btn" onclick="showLanding()">
            <i class="fas fa-arrow-left"></i> Back to Companies
          </div>
          <h2 id="selectedCompanyName"></h2>
          <div style="grid-column: 3;"></div> <!-- Spacer for perfect centering -->
        </div>

        <div class="im-stats">
          <div class="im-stat-card">
            <h3>Total Transactions</h3>
            <div class="stat-value" id="totalTransactions">0</div>
          </div>
          <div class="im-stat-card buy-card">
            <h3>Buys</h3>
            <div class="stat-value" style="color: var(--im-success);" id="buyTransactions">0</div>
          </div>
          <div class="im-stat-card sell-card">
            <h3>Sells</h3>
            <div class="stat-value" style="color: var(--im-danger);" id="sellTransactions">0</div>
          </div>
          <div class="im-stat-card">
            <h3>Total Shares</h3>
            <div class="stat-value" id="totalVolume">0</div>
          </div>
          <div class="im-stat-card buy-card">
            <h3>Shares Bought</h3>
            <div class="stat-value" style="color: var(--im-success);" id="buyVolume">0</div>
            <div class="stat-percent" id="buyVolumePercent">0%</div>
          </div>
          <div class="im-stat-card sell-card">
            <h3>Shares Sold</h3>
            <div class="stat-value" style="color: var(--im-danger);" id="sellVolume">0</div>
            <div class="stat-percent" id="sellVolumePercent">0%</div>
          </div>
        </div>

        <!-- Filters Second -->
        <div class="im-filters">
          <div class="im-filter-group" style="flex: 2;">
            <label for="searchFilter">Search Insider</label>
            <input type="text" id="searchFilter" placeholder="Search name...">
          </div>
          <div class="im-filter-group">
            <label for="transactionFilter">Type</label>
            <select id="transactionFilter">
              <option value="">All Types</option>
              <option value="Buy">Buy</option>
              <option value="Sell">Sell</option>
            </select>
          </div>
          <div class="im-filter-group">
            <label for="positionFilter">Specific Role</label>
            <select id="positionFilter">
              <option value="">All Roles</option>
              <option value="CSUITE">C-Suite (CEO, CFO, etc.)</option>
              <option value="CEO">CEO</option>
              <option value="Director">Director</option>
              <option value="Officer">Officer</option>
              <option value="TenPercentOwner">10% Owner</option>
            </select>
          </div>
          <div class="im-filter-group">
            <label for="quantityFilter">Min Shares</label>
            <select id="quantityFilter">
              <option value="0">Any Amount</option>
              <option value="1000">1K+</option>
              <option value="10000">10K+</option>
              <option value="100000">100K+</option>
              <option value="1000000">1M+</option>
            </select>
          </div>
        </div>

        <!-- Data Third -->
        <div class="im-table-container">
          <table class="im-table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Insider</th>
                <th>Transaction</th>
                <th>Quantity</th>
              </tr>
            </thead>
            <tbody id="transactionsTable">
              <!-- Populated by JS -->
            </tbody>
          </table>
        </div>

        <!-- Disclaimer at the bottom of each company page -->
        <div class="im-disclaimer">
          Disclaimer: This is analytical data, not investment advice. It is a Q3 snapshot as per US government data. Outright equities flow only.
        </div>
      </div>
    </div>
  </main>

  <script>
    const mobileMenu = document.getElementById('mobileMenu');
    function toggleMobileMenu() {
      if (mobileMenu) mobileMenu.classList.toggle('active');
    }
    function closeMobileMenu() {
      if (mobileMenu) mobileMenu.classList.remove('active');
    }

    document.addEventListener('click', (e) => {
      const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
      if (
        mobileMenu &&
        mobileMenu.classList.contains('active') &&
        !mobileMenu.contains(e.target) &&
        !mobileMenuBtn.contains(e.target)
      ) {
        closeMobileMenu();
      }
    });

    async function initLogout() {
      const logoutBtn = document.getElementById('logoutBtn');
      if (!logoutBtn) return;

      logoutBtn.style.display = 'inline-block';
      logoutBtn.style.visibility = 'visible';
      logoutBtn.style.opacity = '1';

      if (!logoutBtn.dataset.listenerAttached) {
        const { logout } = await import('../auth.js');
        logoutBtn.addEventListener('click', (e) => {
          e.preventDefault();
          if (confirm('Are you sure you want to logout?')) {
            logout();
            window.location.href = '/login.html';
          }
        });
        logoutBtn.dataset.listenerAttached = 'true';
      }
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initLogout);
    } else {
      initLogout();
    }

    // Load and display insider moves data
    let allTransactions = [];
    let filteredTransactions = [];
    let selectedCompany = null;

    // Show these companies even if there are no transactions yet (so you can expand coverage over time).
    const EXTRA_COMPANIES = [
      'NVIDIA Corporation (NVDA)',
      'Advanced Micro Devices, Inc. (AMD)',
    ];

    function escapeHtmlAttr(value) {
      return String(value)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
    }

    function getTicker(companyName) {
      const match = String(companyName).match(/\(([^)]+)\)\s*$/);
      return match?.[1]?.trim()?.toUpperCase() || '';
    }

    async function loadData() {
      try {
        const response = await fetch('../data/insider-moves.json');
        if (!response.ok) throw new Error('Failed to load data');
        allTransactions = await response.json();
        
        renderCompanyGrid();
      } catch (error) {
        console.error('Error loading data:', error);
        document.getElementById('companyGrid').innerHTML = `
          <div class="no-results">
            <i class="fas fa-exclamation-triangle"></i>
            <p>Error loading transactions. Please try again later.</p>
          </div>
        `;
      }
    }

    function renderCompanyGrid() {
      const grid = document.getElementById('companyGrid');
      const companies = [...new Set([...allTransactions.map(t => t.company), ...EXTRA_COMPANIES])]
        .filter(Boolean)
        .sort((a, b) => a.localeCompare(b));

      const iconsByTicker = {
        META: 'fab fa-facebook',
        GOOGL: 'fab fa-google',
        GOOG: 'fab fa-google',
        AMZN: 'fab fa-amazon',
        AAPL: 'fab fa-apple',
        NFLX: 'fas fa-play-circle',
        NVDA: 'fas fa-microchip',
        V: 'fab fa-cc-visa',
        JPM: 'fas fa-university',
        INTC: 'fas fa-microchip',
        AMD: 'fas fa-microchip',
      };

      grid.innerHTML = companies.map(company => {
        const cleanName = company.replace(/ Inc\.| Corporation| Platforms,| COM/g, '').split('(')[0].trim();
        const ticker = getTicker(company);
        const icon = iconsByTicker[ticker] || 'fas fa-building';
        const count = allTransactions.filter(t => t.company === company).length;
        
        return `
          <button type="button" class="company-panel" data-company="${escapeHtmlAttr(company)}">
            <div class="company-logo-box">
              <i class="${icon}"></i>
            </div>
            <h2>${cleanName}</h2>
            <div class="trade-count">${count} Recent Transactions</div>
          </button>
        `;
      }).join('');

      // Delegate clicks to avoid inline JS and handle special characters safely.
      grid.onclick = (e) => {
        const panel = e.target?.closest?.('.company-panel');
        if (!panel) return;
        const company = panel.getAttribute('data-company');
        if (!company) return;
        selectCompany(company);
      };
    }

    function selectCompany(company) {
      selectedCompany = company;
      
      // Reset filters when switching companies to prevent persistence glitch
      document.getElementById('searchFilter').value = '';
      document.getElementById('transactionFilter').value = '';
      document.getElementById('positionFilter').value = '';
      document.getElementById('quantityFilter').value = '0';

      const cleanName = company.replace(/ Inc\.| Corporation| Platforms,| COM/g, '').split('(')[0].trim();
      document.getElementById('selectedCompanyName').textContent = cleanName;
      
      // Hide hero and show detail section
      document.getElementById('imHero').style.display = 'none';
      document.getElementById('landingView').style.display = 'none';
      document.getElementById('detailSection').style.display = 'block';
      
      filterTransactions();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function showLanding() {
      selectedCompany = null;
      // Show hero and landing view, hide detail section
      document.getElementById('imHero').style.display = 'block';
      document.getElementById('landingView').style.display = 'block';
      document.getElementById('detailSection').style.display = 'none';
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function parseDate(dateStr) {
      const [day, month, year] = dateStr.split('-');
      const monthMap = {
        'JAN': 0, 'FEB': 1, 'MAR': 2, 'APR': 3, 'MAY': 4, 'JUN': 5,
        'JUL': 6, 'AUG': 7, 'SEP': 8, 'OCT': 9, 'NOV': 10, 'DEC': 11
      };
      return new Date(year, monthMap[month], parseInt(day));
    }

    function formatDate(dateStr) {
      const date = parseDate(dateStr);
      return date.toLocaleDateString('en-US', { 
        year: 'numeric', 
        month: 'short', 
        day: 'numeric' 
      });
    }

    function filterTransactions() {
      if (!selectedCompany) return;

      const transactionType = document.getElementById('transactionFilter').value;
      const search = document.getElementById('searchFilter').value.toLowerCase();
      const position = document.getElementById('positionFilter').value;
      const minQty = parseFloat(document.getElementById('quantityFilter').value) || 0;

      filteredTransactions = allTransactions.filter(t => {
        const matchCompany = t.company === selectedCompany;
        const matchType = !transactionType || t.transactionType === transactionType;
        const matchQty = (t.quantity || 0) >= minQty;
        
        // Nuanced position matching
        let matchPosition = true;
        if (position) {
          const posText = t.position.toUpperCase();
          if (position === 'CSUITE') {
            // Match any "Chief X Officer" or common abbreviations
            matchPosition = posText.includes('CHIEF') || 
                            posText.includes('CEO') || posText.includes('CFO') || 
                            posText.includes('COO') || posText.includes('CTO') || 
                            posText.includes('CMO') || posText.includes('EXECUTIVE CHAIR');
          } else if (position === 'CEO') {
            matchPosition = posText.includes('CEO') || posText.includes('CHIEF EXECUTIVE OFFICER');
          } else {
            // General matching for Director, Officer, 10% Owner
            matchPosition = posText.includes(position.toUpperCase());
          }
        }

        const matchSearch = !search || 
          t.name.toLowerCase().includes(search) ||
          t.position.toLowerCase().includes(search);
        
        return matchCompany && matchType && matchPosition && matchQty && matchSearch;
      });

      // Sort by date (newest first - chronological order as requested)
      filteredTransactions.sort((a, b) => {
        const dateA = parseDate(a.date);
        const dateB = parseDate(b.date);
        return dateB - dateA;
      });

      updateStats();
      renderTable();
    }

    function updateStats() {
      const total = filteredTransactions.length;
      const buys = filteredTransactions.filter(t => t.transactionType === 'Buy');
      const sells = filteredTransactions.filter(t => t.transactionType === 'Sell');

      const buyCount = buys.length;
      const sellCount = sells.length;

      const totalVol = filteredTransactions.reduce((sum, t) => sum + (t.quantity || 0), 0);
      const buyVol = buys.reduce((sum, t) => sum + (t.quantity || 0), 0);
      const sellVol = sells.reduce((sum, t) => sum + (t.quantity || 0), 0);

      const buyVolPct = totalVol > 0 ? ((buyVol / totalVol) * 100).toFixed(1) : 0;
      const sellVolPct = totalVol > 0 ? ((sellVol / totalVol) * 100).toFixed(1) : 0;

      document.getElementById('totalTransactions').textContent = total.toLocaleString();
      document.getElementById('buyTransactions').textContent = buyCount.toLocaleString();
      document.getElementById('sellTransactions').textContent = sellCount.toLocaleString();

      document.getElementById('totalVolume').textContent = formatQuantity(totalVol);
      document.getElementById('buyVolume').textContent = formatQuantity(buyVol);
      document.getElementById('sellVolume').textContent = formatQuantity(sellVol);

      document.getElementById('buyVolumePercent').textContent = `${buyVolPct}% of total shares`;
      document.getElementById('sellVolumePercent').textContent = `${sellVolPct}% of total shares`;
      document.getElementById('buyVolumePercent').style.color = 'var(--im-success)';
      document.getElementById('sellVolumePercent').style.color = 'var(--im-danger)';
    }

    function formatQuantity(quantity) {
      if (quantity >= 1000000) {
        return (quantity / 1000000).toFixed(2) + 'M';
      } else if (quantity >= 1000) {
        return (quantity / 1000).toFixed(2) + 'K';
      }
      return quantity.toLocaleString();
    }

    function renderTable() {
      const tbody = document.getElementById('transactionsTable');
      
      if (filteredTransactions.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="4" class="no-results">
              <i class="fas fa-search"></i>
              <p>No transactions found matching your filters.</p>
            </td>
          </tr>
        `;
        return;
      }

      tbody.innerHTML = filteredTransactions.map(t => `
        <tr>
          <td>${formatDate(t.date)}</td>
          <td>
            <div class="insider-name">${t.name}</div>
            <div class="insider-position">${t.position.split('â€”')[0].trim()}</div>
          </td>
          <td>
            <span class="transaction-badge ${t.transactionType.toLowerCase()}">${t.transactionType}</span>
          </td>
          <td>
            <span class="quantity">${formatQuantity(t.quantity)}</span>
          </td>
        </tr>
      `).join('');
    }

    // Event listeners
    document.getElementById('transactionFilter').addEventListener('change', filterTransactions);
    document.getElementById('searchFilter').addEventListener('input', filterTransactions);
    document.getElementById('positionFilter').addEventListener('change', filterTransactions);
    document.getElementById('quantityFilter').addEventListener('change', filterTransactions);

    // Load data on page load
    loadData();
  </script>
</body>
</html>

